% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/FuncPairBatchFeature.R
\name{batchFindSignificantFeatures}
\alias{batchFindSignificantFeatures}
\title{Batch analysis to find significant features associated with a reference feature using DromaSet objects}
\usage{
batchFindSignificantFeatures(
  dromaset_object,
  feature1_type,
  feature1_name,
  feature2_type,
  feature2_name = NULL,
  data_type = "all",
  tumor_type = "all",
  overlap_only = FALSE,
  cores = 1,
  show_progress = TRUE,
  progress_callback = NULL,
  test_top_n = NULL,
  preloaded = NULL,
  verbose = FALSE
)
}
\arguments{
\item{dromaset_object}{Either a DromaSet or MultiDromaSet object}

\item{feature1_type}{Type of the reference feature (e.g., "drug", "mRNA")}

\item{feature1_name}{Name of the reference feature}

\item{feature2_type}{Type of features to test against (e.g., "mRNA", "mutation_gene")}

\item{feature2_name}{Optional vector of specific feature names to test (default: NULL for all features)}

\item{data_type}{Filter by data type ("all", "CellLine", "PDO", "PDC", "PDX")}

\item{tumor_type}{Filter by tumor type ("all" or specific tumor types)}

\item{overlap_only}{For MultiDromaSet, whether to use only overlapping samples (default: FALSE)}

\item{cores}{Number of CPU cores to use for parallel processing (uses future + furrr with task chunking for efficiency)}

\item{show_progress}{Logical, whether to show progress updates (default: TRUE). 
Progress updates include: current count, percentage, elapsed time, and estimated time remaining.
Serial mode (cores=1): uses built-in progress tracker. Parallel mode (cores>1): uses progressr package if available.}

\item{progress_callback}{Optional custom callback function for progress updates (serial mode only). 
If NULL (default), uses built-in progress tracking. Function signature: function(done, total, elapsed_seconds)}

\item{test_top_n}{Integer, number of top features to test (default: NULL for all features)}

\item{preloaded}{Logical or NULL, whether to preload all feature2 data at once (default: NULL for auto).
Note: Discrete features (mutation_gene, mutation_site, fusion) ONLY support preload mode.
For continuous features:
NULL (auto): Preload when feature2 count > 1000, otherwise load on-demand
TRUE: Always preload all feature2 data (faster for large datasets, uses more memory)
FALSE: Load feature2 data on-demand (slower but memory efficient)}

\item{verbose}{Logical, whether to display detailed messages from internal functions (default: FALSE)}
}
\value{
Data frame with meta-analysis results (p_value, effect_size, n_datasets, name, q_value). NA values are replaced: p_value -> 1, effect_size -> 0. q_value is calculated using Benjamini-Hochberg method
}
\description{
Performs batch analysis to identify features significantly associated with a reference feature using DromaSet or MultiDromaSet objects
}
\section{Execution Flow}{

The function follows this high-level workflow:
1. Input validation and parameter setup
2. Feature type determination (continuous vs discrete)
3. Load and validate reference feature (feature1) data
4. Get list of features to test (feature2) - uses listDROMAFeatures() for efficient database queries
5. Data loading strategy: discrete features use preload mode (required), continuous features can use preload or on-demand
6. Parallel/sequential processing of feature pairs
7. Statistical testing based on feature types
8. Result aggregation and reporting
}

\examples{
\dontrun{
# Using DromaSet
gCSI <- createDromaSetFromDatabase("gCSI", "path/to/droma.sqlite")
results <- batchFindSignificantFeatures(gCSI, "drug", "Paclitaxel", "mRNA")

# Using MultiDromaSet
multi_set <- createMultiDromaSetFromDatabase(c("gCSI", "CCLE"), "path/to/droma.sqlite")
results <- batchFindSignificantFeatures(multi_set, "drug", "Paclitaxel", "mRNA",
                                  feature2_name = c("TP53", "EGFR"))

# Test only top 50 features for debugging
results <- batchFindSignificantFeatures(multi_set, "drug", "Paclitaxel", "mRNA", test_top_n = 50)

# Force preload for faster processing (recommended for >1000 continuous features)
results <- batchFindSignificantFeatures(multi_set, "drug", "Paclitaxel", "mRNA", 
                                        preloaded = TRUE, cores = 8)

# Force on-demand loading for memory efficiency (continuous features only)
results <- batchFindSignificantFeatures(multi_set, "drug", "Paclitaxel", "mRNA", 
                                        preloaded = FALSE)

# Auto mode (default): preloads when >1000 continuous features
results <- batchFindSignificantFeatures(multi_set, "drug", "Paclitaxel", "mRNA")

# Discrete features always use preload mode (required)
results <- batchFindSignificantFeatures(multi_set, "drug", "Paclitaxel", "mutation_gene", 
                                        cores = 8)

# With progress tracking (serial mode, cores = 1)
results <- batchFindSignificantFeatures(gCSI, "drug", "Paclitaxel", "mRNA",
                                        cores = 1, show_progress = TRUE)

# Parallel with progressr (requires: install.packages("progressr"))
library(progressr)
handlers(global = TRUE)
handlers("progress")  # or "txtprogressbar"
results <- batchFindSignificantFeatures(gCSI, "drug", "Paclitaxel", "mRNA",
                                        cores = 8, show_progress = TRUE)

# Custom progress callback (serial mode only)
my_progress <- function(done, total, elapsed) {
  message(sprintf("Processed \%d/\%d features in \%.1f seconds", done, total, elapsed))
}
results <- batchFindSignificantFeatures(gCSI, "drug", "Paclitaxel", "mRNA",
                                        progress_callback = my_progress, cores = 1)
}
}
